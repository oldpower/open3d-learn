## 简介
Open3D是一个开源库，旨在使3D数据处理更加易于访问和高效。它支持从3D数据处理到3D深度学习的广泛操作，提供了从基本的数据结构到最先进的算法实现等一系列功能。使用Open3D，用户可以轻松地进行点云处理、网格操作、3D数据可视化等任务。

该库是用C++开发的，并且提供了Python接口，这使得它既适合需要高性能的应用场景也适合快速原型设计和脚本编写。Open3D的设计考虑了与PyTorch等深度学习框架的兼容性，因此非常适合涉及3D深度学习的研究和应用。
![open3d logo](./assets/open3d.png)
Open3D的功能包括但不限于：

- **3D数据读写**：支持多种3D数据格式，如PLY、STL、OBJ等。
- **点云处理**：提供点云滤波、下采样、法线估计、特征计算等功能。
- **网格处理**：支持网格简化、重建、平滑等操作。
- **3D可视化**：内置了强大的可视化工具，便于用户直观地查看和交互式探索3D数据。
- **3D机器学习**：集成了对3D深度学习的支持，允许用户直接在3D数据上训练模型。



## 1、可视化
```python
python 01_visulization.py
```
 - [open3d_visulization](./assets/open3d_visulization.md)


## 2、滤波去噪

### 2.1 统计滤波、半径滤波
```python
python 02_filtered.py
```

### 2.2 下采样、欧式聚类分割（基础）

```python
python 02_voxel_ds_DBSCAN_01.py
```
#### ✅ 支持的场景类型
| 类型 | 描述 | 示例 |
|------|------|------|
| `'ground'` | 地面平坦区域 | 无人驾驶、机器人导航等场景 |
| `'building'` | 建筑物结构 | 城市建模、BIM 等 |
| `'vegetation'` | 植被、树木 | 园林扫描、森林 LiDAR |
| `'lidar'` | 通用 LiDAR 扫描 | 不明确场景时的默认值 |

#### 🧠 参数策略说明
| 参数 | 含义 | 地面 | 建筑 | 植被 | LiDAR（默认） |
|------|------|------|------|------|----------------|
| `voxel_size` | 下采样粒度 | 0.05~0.1 m | 0.1~0.2 m | 0.05~0.1 m | 0.1 m |
| `eps` | DBSCAN 邻域半径 | 0.3 m | 0.5 m | 0.2 m | 0.3 m |
| `min_points` | 成簇最小点数 | 10 | 20 | 5 | 10 |
| `min_cluster_size` | 最小簇大小 | 50 | 100 | 20 | 50 |

### 2.3 下采样、欧式聚类分割（进阶）

```python
python 02_voxel_ds_DBSCAN_02.py
```


#### 📌 三、功能说明总结
| 功能 | 描述 |
|------|------|
| ✅ 单位检测 | 判断点云是否为 mm 或 m |
| ✅ 自动缩放 | 统一转换为米制单位，避免参数错误 |
| ✅ 场景识别 | 支持地面、建筑、植被、通用 LiDAR 四种类型 |
| ✅ 颜色保留 | 若输入有颜色信息则保留输出颜色 |
| ✅ 对比可视化 | 分别展示原始点云与去噪后点云 |


#### 🧠 为什么需要“单位检测 + 统一缩放”？

点云数据可能来自不同设备（如 LiDAR、RGB-D 相机、SfM 等），其单位可能是：
- **毫米（mm）**：常见于某些激光雷达或工业扫描仪
- **米（m）**：常见于 SLAM 或航拍重建

如果不统一单位，可能导致 DBSCAN 参数失效（例如 `eps=0.3` 在毫米下是 30cm，在米下是 30cm，但如果点云是 mm 单位却按 m 处理，就会误判为噪声）。


## 案例
### 案例1
基于 Open3D 实现茶芽点云分割与聚类的代码框架，包含点云预处理、RANSAC 直线拟合与 DBSCAN 聚类算法，用于区分芽头、叶片和根茎，代码`tea_sprout.py`。

#### **RANSAC 直线拟合**

在Open3D的`segment_plane`函数中，这三个参数用于RANSAC（随机抽样一致）算法进行平面分割。以下是它们的详细解释：

1. **distance_threshold**（距离阈值）：
    - 定义：点到平面被认为是"内点"（inlier）的最大距离
    - 作用：所有距离小于此阈值的点会被视为该平面的内点
    - 典型值：根据点云尺度调整（例如，对于米为单位的点云可能是0.01-0.1）

2. **ransac_n**（RANSAC采样点数）：
    - 定义：每次RANSAC迭代中用于拟合平面的随机采样点数
    - 作用：通常设为3，因为三点可以确定一个平面方程
    - 注意：增加此值会提高每次拟合的准确性但降低计算效率

3. **num_iterations**（迭代次数）：
    - 定义：RANSAC算法运行的最大迭代次数
    - 作用：更多迭代会增加找到最佳平面的概率但会增加计算时间
    - 自动计算：可以设为0，让算法根据内点比例自动估计所需迭代次数

函数返回：
- `line_model`：平面参数（a, b, c, d），对应平面方程ax + by + cz + d = 0
- `inliers`：满足平面模型的内点索引列表

- 示例使用场景：

    ```python
    # 从点云中分割桌面平面
    plane_model, inliers = pcd.segment_plane(
        distance_threshold=0.02,  # 2cm阈值
        ransac_n=3,               # 每次采样3个点
        num_iterations=1000)      # 运行1000次迭代
    ```

#### **DBSCAN 聚类算法**

在Open3D的`cluster_dbscan`函数中，`eps`参数是**DBSCAN（Density-Based Spatial Clustering of Applications with Noise）**算法的核心参数之一，用于控制聚类的密度范围。以下是具体解释：

**`eps` 参数的意义：**

1. **定义**：  
   - `eps`（ε）是**邻域半径**，表示在多大范围内搜索邻近点。  
   - 两点之间的欧氏距离如果 ≤ `eps`，则认为它们是同一簇的候选点。

2. **作用**：  
   - 决定聚类的**密度敏感度**：  
     - **较小的`eps`**：算法对密度更敏感，会生成更多小簇（适合密集点云）。  
     - **较大的`eps`**：允许更稀疏的聚类，可能将多个本应分开的簇合并（适合稀疏点云）。  
   - 直接影响核心点（core points）的判定：  
     - 一个点如果在`eps`半径内有至少`min_points`个邻居，则被标记为核心点，从而扩展成一个簇。

3. **如何选择**：  
   - 需要根据点云的**尺度**和**密度**调整：  
     - 例如，对于以米为单位的树木点云，`eps`可能在0.1~1.0之间（具体值需实验调整）。  
   - 可通过可视化或统计分析（如KNN距离曲线）辅助确定。

**与其他参数的关系：**
- **`min_points`**：  
  - 配合`eps`使用，表示形成簇所需的最小邻域点数。  
  - 例如，`eps=0.5, min_points=10` 表示：在0.5米半径内至少有10个点才会被视为有效簇。

- **`print_progress=True`**：  
  - 仅控制是否在控制台打印聚类进度，不影响算法结果。



 - **示例场景**

    ```python
    # 对非树干部分的点云进行聚类（如树叶、地面）
    labels = np.array(non_stem.cluster_dbscan(
        eps=0.3,          # 邻域半径30厘米
        min_points=20,    # 每个簇至少需要20个点
        print_progress=True
    ))
    ```

- **输出**：  
  `labels`是一个整数数组，其中：  
  - `-1` 表示噪声点（不属于任何簇）。  
  - `0, 1, 2,...` 表示不同的簇ID。



